(global) {
  crowdsec {
    api_url http://crowdsec:8080
    api_key `{$CROWDSEC_BOUNCER_API_KEY}`
    ticker_interval 15s
    # disable_streaming
    # enable_hard_fails
  }
}


(public_website) {
  {args.0} {
    log {
      output file /var/log/caddy/access.log
    }
    route {
      crowdsec
      file_server
    }
  }
}


(development) {
  {
    import global
    debug
  }

  import public_website localhost
}

(production) {
  {
    import global

    email `{$EMAIL}`

    servers `{$DOMAIN}:443` {
      name public
    }

  }


  `www.{$DOMAIN}` {
    redir https://{$DOMAIN}{uri} permanent
  }
  import public_website `{$DOMAIN}, localhost`
}

{$CADDY_EXTRA_DIRECTIVES}
